---
workspace:
  base: /app
  path: src/github.com/gr4y/fritzbox-graphite

branches:
  - master

kind: pipeline

steps:
  - name: build-linux
    image: karalabe/xgo-latest:latest
    pull: true
    group: release
    environment:
      - CGO_ENABLED=0
      - GOPATH=/app
      - TAGS=
    commands: 
      - make release-dirs release-linux
  - name: build-windows
    image: karalabe/xgo-latest:latest
    pull: true
    group: release
    environment:
      - CGO_ENABLED=0
      - GOPATH=/app
      - TAGS=
    commands: 
      - make release-dirs release-windows
  - name: build-darwin
    image: karalabe/xgo-latest:latest
    pull: true
    group: release
    environment:
      - CGO_ENABLED=0
      - GOPATH=/app
      - TAGS=
    commands: 
      - make release-dirs release-darwin
- name: notification
    image: plugins/pushover
    settings:
      message: "{{ repo.owner }}/{{ repo.name }}#{{ truncate build.commit 8 }} ({{ build.branch }}) by {{ build.author }} - {{ build.message }}"
      token:
        from_secret: pushover_token
      user:
        from_secret: pushover_user
      failure: ignore
      when:
        status:
          - success
          - failure
